<!DOCTYPE html>
<html>

<head>
    <title>Monitor Android HTTP traffic</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./css/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <style>
        code,
        samp,
        kbd {
            font-family: "Courier New", Courier, monospace, sans-serif;
            text-align: left;
            color: #555;
        }
        
        pre code {
            line-height: 1.6em;
            font-size: 11px;
        }
        /*border-left: 11px solid #ccc;*/
        
        p {
            width: 93%;
        }
        
        pre {
            font-family: UbuntuMono, courier, monospace;
            padding: 4pt;
            background-color: #F3F3F3;
            padding: 0.1em 0.5em 0.3em 0.7em;
            border: 1px dashed #C1B496;
            overflow: auto;
            width: 93%;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        /* target IE7 and IE6 */
        
        *:first-child+html pre {
            padding-bottom: 2em;
            overflow-y: hidden;
            overflow: visible;
            overflow-x: auto;
        }
        
        * html pre {
            padding-bottom: 2em;
            overflow: visible;
            overflow-x: auto;
        }
        
        hr.style-one {
            border: 0;
            border-bottom: 1px dashed #ccc;
            background: #999;
        }
        
        hr.style-eight {
            padding: 0;
            border: none;
            border-top: medium double #333;
            color: #333;
            text-align: center;
        }
        
        hr.style-eight:after {
            content: "§";
            display: inline-block;
            position: relative;
            top: -0.7em;
            font-size: 1.5em;
            padding: 0 0.25em;
            background: white;
        }
        
        .container {
            background-color: #fff;
        }
        
        .container-inner {
            -moz-border-radius: 0px 0px 5px 5px;
            -webkit-border-bottom-left-radius: 5px;
            -webkit-border-bottom-right-radius: 5px;
            -moz-box-shadow: #bbb 0px 0px 5px;
            -webkit-box-shadow: #bbb 0px 0px 5px;
        }
        /*.header {
            background: url(./images/header.png) top left repeat-x;
            height: 64px;
            margin: 0px;
            padding: 0px;
            vertical-align: middle;
            border-radius: 15px;
            position: relative;
        }*/
        
        @font-face {
            font-family: 'cornerstone';
            src: url('./fonts/c.ttf');
        }
        
        h1 {
            font-size: 3em;
        }
        
        body {
            background-image: url("./images/stardust/stardust/stardust.png");
            background-attachment: fixed;
        }
    </style>

</head>

<body>

    <div class="container">
        <div class="header">
            <h1 style="font-family:cornerstone;" align="center">Monitoring Android HTTP traffic</h2>
            
        <hr class="style-eight">
        </div>

        <p>This tutorial will cover how to:</p>
        <ol>
            <li>Configure a locally controlled VPN server (PPTP Server)</li>
            <li>Connect an Android device to this server</li>
            <li>Setup and forward VPN traffic to mitmproxy</li>
        </ol>
        
        <a href="test.7z" download="TEST">test</a>

        <hr class="style-one">

        <p><big><b>Setup PPTP Server</b></big></p>
        <p>The setup of the PPTP server is covered <a href="https://help.ubuntu.com/community/PPTPServer" target="_blank">here</a>            in the Ubuntu community. I have, however, included these instructions below with some additional notes that helped me.</p>

        <button id="pptpToggle1" onclick="changeToggleText(this)" type="button" class="btn btn-info" data-toggle="collapse" data-target="#demo">Show PPTP server instructions</button>
        <div id="demo" class="collapse">

            <br>
            <p><big><b>Setup PPTP Server</b></big></p>

            <p>First we need to install pptp server using apt-get</p>
            <pre><code>sudo apt-get install pptpd</code></pre>
            <p>Then we need to configure the pptpd.</p>
            <pre><code>sudo nano /etc/pptpd.conf</code></pre>
            <p>Add server IP and client IP at the end of the file. You can add like below:</p>
            <pre><code>localip 192.168.0.1<br>remoteip 192.168.0.100-200</code></pre>
                
                <p>This sets up the PPTP server to use IP 192.168.0.1 while distributing the IP range 192.168.0.100 to 192.168.0.200
                to PPTP clients. Change these as you wish as long as they are private IP addresses and do not conflict with
                IP addresses already used by your server.</p>
                <p>Configure DNS servers to use when clients connect to this PPTP
                server</p>
            <pre><code>sudo nano /etc/ppp/pptpd-options</code></pre>
            <p>Uncomment the ms-dns and add google like below or OpenDNS</p>
            <pre><code>ms-dns 8.8.8.8<br>ms-dns 8.8.4.4</code></pre>
                </pre>
                <p>Now add a VPN user in /etc/ppp/chap-secrets file.</p>
                <pre><code>sudo nano /etc/ppp/chap-secrets</code></pre> 
                <p>The column is username. Second column is server
                name, you can put “pptpd” in there. Third column is password. The last column is the IP addresses, you can
                put * to allow all IP.</p>
                <pre><code>client    server    secret    IP addresses
username * myPassword *</code></pre> 
<p>Finally start your server</p>
                <pre><code>/etc/init.d/pptpd restart</code></pre> 
                <p><big><b>Setup IP Forwarding </b></big></p>
                <p>To enable IPv4 forward, add the below forward rule to '/etc/sysctl.conf'</p>
                <pre><code>sudo nano /etc/sysctl.conf</code></pre> 
                <p>Uncomment the line</p>
                <pre><code>net.ipv4.ip_forward=1</code></pre> 
                <p>Then reload the configuration</p>
                <pre><code>sudo sysctl -p</code></pre> 
                <p>Add forward rule in iptables</p>
                <pre><code>sudo nano /etc/rc.local</code></pre> 
                <p>Adding to the bottom just before the exit 0</p>
                <pre><code>iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE
iptables -A FORWARD -p tcp --syn -s 192.168.0.0/24 -j TCPMSS --set-mss 1356</code></pre> 

<p>This example is using 192.168.0 for its PPTP subnet. The second rule adjusts the MTU size. You are done, Just reboot your
                server and you should be able to connect to using PPTPD and send all your traffic through this server.</p>

    <button id="pptpToggle2" onclick="changeToggleText(this)" type="button" class="btn btn-info" data-toggle="collapse" data-target="#demo">Hide PPTP server instructions</button>

        </div>
        <hr class="style-one">
        <p><big><b>Connect an Android device to this server</b></big></p>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna
            aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
        </p>

        <pre><code># sudo apt-get install pptpd</code></pre>

        <hr class="style-one">
        <p><big><b>Setup and forward VPN traffic to mitmproxy</b></big></p>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna
            aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
        </p>

        <pre><code># sudo apt-get install pptpd</code></pre>



    </div>



</body>
<script>
            function changeToggleText(id) { 
                if(id.innerHTML == "Show PPTP server instructions"){
                    pptpToggle1.innerHTML ="Hide PPTP server instructions";
                    pptpToggle1.innerHTML ="Hide PPTP server instructions";
                }else{
                    pptpToggle1.innerHTML ="Show PPTP server instructions";
                    pptpToggle1.innerHTML ="Show PPTP server instructions";
                }
            }
        </script>

</html>